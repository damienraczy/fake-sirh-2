<!-- sirh/templates/departments.html -->
{% extends "base.html" %}

{% block title %}D√©partements - {{ config.company_name }}{% endblock %}

{% block content %}
<h1 class="card-title mb-6">üèõÔ∏è D√©partements</h1>

<div class="card">
    <div id="departmentsList"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadDepartments() {
    Utils.showLoading('departmentsList');
    
    try {
        const departments = await SirhAPI.getDepartments();
        
        const columns = [
            { key: 'name', label: 'Nom' },
            { key: 'description', label: 'Description' },
            { key: 'employee_count', label: 'Employ√©s', render: (count) => Utils.formatNumber(count) },
            { 
                key: 'id', 
                label: 'Actions', 
                render: (id) => `<button onclick="showDepartmentEmployees(${id})" class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Voir employ√©s</button>`
            }
        ];
        
        TableManager.create('departmentsList', departments, columns);
        
    } catch (error) {
        Utils.showError('departmentsList');
    }
}

async function showDepartmentEmployees(deptId) {
    try {
        const employees = await SirhAPI.getDepartmentEmployees(deptId);
        
        if (employees.length === 0) {
            alert('Aucun employ√© dans ce d√©partement');
            return;
        }
        
        const employeesList = employees.map(emp => 
            `‚Ä¢ ${emp.first_name} ${emp.last_name} (${emp.title || 'Poste non d√©fini'})`
        ).join('\n');
        
        alert(`Employ√©s du d√©partement:\n\n${employeesList}`);
        
    } catch (error) {
        alert('Erreur lors du chargement des employ√©s');
    }
}

loadDepartments();
</script>
{% endblock %}
