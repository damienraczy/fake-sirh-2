<!-- sirh/templates/skills.html -->
{% extends "base.html" %}

{% block title %}Comp√©tences - {{ config.company_name }}{% endblock %}

{% block content %}
<h1 class="card-title mb-6">üéØ Comp√©tences</h1>

<div class="card">
    <div id="skillsList"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadSkills() {
    Utils.showLoading('skillsList');
    
    try {
        const skills = await SirhAPI.getSkills();
        
        const columns = [
            { key: 'name', label: 'Comp√©tence' },
            { key: 'category', label: 'Cat√©gorie', type: 'badge', badgeClass: () => 'badge-primary' },
            { key: 'employee_count', label: 'Employ√©s', render: (count) => Utils.formatNumber(count) },
            { 
                key: 'id', 
                label: 'Actions', 
                render: (id) => `<button onclick="showSkillEmployees(${id})" class="btn btn-primary" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Voir employ√©s</button>`
            }
        ];
        
        TableManager.create('skillsList', skills, columns);
        
    } catch (error) {
        Utils.showError('skillsList');
    }
}

async function showSkillEmployees(skillId) {
    try {
        const employees = await SirhAPI.getSkillEmployees(skillId);
        
        if (employees.length === 0) {
            alert('Aucun employ√© avec cette comp√©tence');
            return;
        }
        
        const employeesList = employees.map(emp => 
            `‚Ä¢ ${emp.first_name} ${emp.last_name} - ${emp.level} (${emp.department || 'D√©partement non d√©fini'})`
        ).join('\n');
        
        alert(`Employ√©s avec cette comp√©tence:\n\n${employeesList}`);
        
    } catch (error) {
        alert('Erreur lors du chargement des employ√©s');
    }
}

loadSkills();
</script>
{% endblock %}
